<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OptiLearn – {{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="/static/opti_app/css/app_v2.css" rel="stylesheet">
    <!-- Markdown + Sanitizer -->
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <!-- MathJax (LaTeX) -->
    <script>
      window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js"></script>
    <script>
      window.OPTI = { CSRF: "{{ csrf_token }}", METHOD: "{{ method_key }}" };
    </script>
  </head>
  <body class="bg-gradient theme-dark method-page enhanced-ui">
    <!-- Animated Background -->
    <div class="animated-bg">
      <div class="gradient-orb gradient-orb--1"></div>
      <div class="gradient-orb gradient-orb--2"></div>
      <div class="gradient-orb gradient-orb--3"></div>
    </div>
    
    <div class="d-flex min-vh-100 app-shell">
      <div class="flex-grow-1 d-flex flex-column">
        <main class="px-4 pt-3 d-flex flex-column gap-4 method-layout">
          <section class="method-container glass-card p-0 flex-grow-1 w-100">
            <!-- Header con navegación -->
            <div class="method-header px-4 py-3 d-flex align-items-center gap-3">
              <button class="menu-btn menu-btn--enhanced" id="menuBtn" title="Menú">
                <span class="inner"></span>
              </button>
              <div class="method-header__title">
                <h5 class="m-0 fw-semibold">{{ title }}</h5>
                <span class="method-header__subtitle text-muted small">Solver Pedagógico Interactivo</span>
              </div>
              <div class="ms-auto d-flex align-items-center gap-2">
                <span class="status-indicator status-indicator--ready" id="solverStatus">
                  <i class="bi bi-circle-fill"></i> <span>Listo</span>
                </span>
              </div>
            </div>
            
            <div class="method-content p-4">
              <!-- ═══════════════════════════════════════════════════════════════════════
                   SECCIÓN 1: HERO - Presentación del método
              ═══════════════════════════════════════════════════════════════════════ -->
              <section class="method-section method-section--hero mb-4 fade-in-up">
                <div class="hero-card {% block hero_color_class %}hero-card--primary{% endblock %}">
                  <div class="hero-card__icon">
                    {% block method_icon %}
                    <i class="bi bi-graph-up-arrow"></i>
                    {% endblock %}
                  </div>
                  <div class="hero-card__content">
                    <div class="hero-card__tags">
                      {% block method_tags %}
                      <span class="tag tag--method"><i class="bi bi-sliders"></i> Optimización</span>
                      <span class="tag tag--level"><i class="bi bi-mortarboard"></i> Intermedio</span>
                      {% endblock %}
                    </div>
                    <h2 class="hero-card__title mt-2">{{ title }}</h2>
                    <p class="hero-card__description mt-2">
                      {% block method_description %}Método de optimización matemática.{% endblock %}
                    </p>
                    <div class="hero-card__stats mt-3">
                      {% block method_stats %}
                      <div class="stat-chip"><i class="bi bi-input-cursor-text"></i> <span>Entrada</span><strong>Función</strong></div>
                      <div class="stat-chip"><i class="bi bi-bullseye"></i> <span>Salida</span><strong>Punto óptimo</strong></div>
                      <div class="stat-chip"><i class="bi bi-clock-history"></i> <span>Tiempo</span><strong>~1 seg</strong></div>
                      {% endblock %}
                    </div>
                  </div>
                </div>
              </section>

              <!-- Grid principal: Formulario (izq) + Guía rápida (der) -->
              <div class="method-input-grid mb-4">
                <!-- ═══════════════════════════════════════════════════════════════════════
                     SECCIÓN 2: FORMULARIO DE DATOS DEL PROBLEMA
                ═══════════════════════════════════════════════════════════════════════ -->
                <section class="method-section method-section--form glass-card p-4 fade-in-up">
                  <div class="section-header">
                    <div class="section-header__icon section-header__icon--form"><i class="bi bi-pencil-square"></i></div>
                    <div class="section-header__text">
                      <h5 class="section-header__title mb-0">Datos del problema</h5>
                      <span class="section-header__subtitle">Ingresa los parámetros de tu problema</span>
                    </div>
                  </div>
                  
                  <div class="form-body mt-4">
                    {% block method_form %}
                    <!-- Campos requeridos -->
                    <div class="form-group-modern mb-3">
                      <label class="form-label-modern">
                        <i class="bi bi-function"></i> Función objetivo $f(x)$
                        <span class="required-badge">Requerido</span>
                      </label>
                      <textarea id="objective" class="form-control form-control-modern" rows="2" placeholder="(x-1)**2 + (y-2)**2"></textarea>
                      <div class="form-hint"><i class="bi bi-info-circle"></i> Sintaxis SymPy: <code>x**2</code>, <code>sin(x)</code>, <code>exp(x)</code>, <code>sqrt(x)</code></div>
                    </div>
                    
                    <div class="form-group-modern mb-3">
                      <label class="form-label-modern">
                        <i class="bi bi-list-ul"></i> Variables de decisión
                        <span class="required-badge">Requerido</span>
                      </label>
                      <input id="variables" class="form-control form-control-modern" placeholder="x,y">
                      <div class="form-hint"><i class="bi bi-info-circle"></i> Separadas por coma. Ej: <code>x,y,z</code></div>
                    </div>
                    {% endblock %}
                    
                    {% block method_form_constraints %}
                    <!-- Área para restricciones - definida por cada método -->
                    {% endblock %}
                    
                    {% block method_form_optional %}
                    <!-- Parámetros opcionales - definidos por cada método -->
                    {% endblock %}
                  </div>
                  
                  <!-- Botones de acción -->
                  <div class="form-actions mt-4">
                    <button id="solveBtn" class="btn btn-solve">
                      <i class="bi bi-play-fill"></i>
                      <span>Resolver paso a paso</span>
                      <div class="btn-shine"></div>
                    </button>
                    <button id="resetBtn" class="btn btn-reset" title="Limpiar formulario">
                      <i class="bi bi-arrow-counterclockwise"></i>
                      <span>Limpiar</span>
                    </button>
                  </div>
                  
                  <!-- Ejemplos rápidos -->
                  {% block method_examples %}
                  <div class="examples-section mt-4">
                    <div class="examples-header">
                      <i class="bi bi-lightning-charge"></i>
                      <span>Ejemplos rápidos</span>
                    </div>
                    <div class="examples-grid">
                      <!-- Definidos por cada método -->
                    </div>
                  </div>
                  {% endblock %}
                </section>
                
                <!-- ═══════════════════════════════════════════════════════════════════════
                     SECCIÓN 3: VALIDACIONES + SECCIÓN 4: GUÍA RÁPIDA
                ═══════════════════════════════════════════════════════════════════════ -->
                <div class="method-sidebar">
                  <!-- Bloque de validaciones -->
                  <section class="method-section method-section--validation glass-card p-4 fade-in-up mb-3" style="animation-delay: 0.1s">
                    <div class="section-header section-header--compact">
                      <div class="section-header__icon section-header__icon--validation"><i class="bi bi-shield-check"></i></div>
                      <h6 class="section-header__title mb-0">Validaciones</h6>
                    </div>
                    <div id="methodErrors" class="validation-box validation-box--neutral mt-3">
                      <i class="bi bi-info-circle"></i>
                      <span>Completa los campos requeridos para comenzar.</span>
                    </div>
                  </section>
                  
                  <!-- Guía pedagógica rápida -->
                  <section class="method-section method-section--guide glass-card p-4 fade-in-up" style="animation-delay: 0.15s">
                    <div class="section-header section-header--compact">
                      <div class="section-header__icon section-header__icon--guide"><i class="bi bi-lightbulb"></i></div>
                      <h6 class="section-header__title mb-0">Guía pedagógica</h6>
                    </div>
                    <ul class="guide-list mt-3">
                      {% block method_guide %}
                      <li class="guide-item">
                        <span class="guide-number">1</span>
                        <span class="guide-text">Ingresa la función objetivo a optimizar.</span>
                      </li>
                      <li class="guide-item">
                        <span class="guide-number">2</span>
                        <span class="guide-text">Define las variables de decisión.</span>
                      </li>
                      <li class="guide-item">
                        <span class="guide-number">3</span>
                        <span class="guide-text">Agrega restricciones si aplica.</span>
                      </li>
                      <li class="guide-item">
                        <span class="guide-number">4</span>
                        <span class="guide-text">Haz clic en "Resolver" y analiza cada paso.</span>
                      </li>
                      {% endblock %}
                    </ul>
                    
                    {% block method_tips %}
                    <div class="tips-box mt-3">
                      <div class="tips-box__header"><i class="bi bi-info-circle"></i> Tip</div>
                      <div class="tips-box__content">
                        Revisa cada paso del procedimiento para entender la matemática detrás del resultado.
                      </div>
                    </div>
                    {% endblock %}
                  </section>
                </div>
              </div>
              
              {% block method_body %}
              <!-- ═══════════════════════════════════════════════════════════════════════
                   SECCIÓN 5: SOLUCIÓN PASO A PASO (3 subsecciones)
              ═══════════════════════════════════════════════════════════════════════ -->
              <section class="method-section method-section--solution glass-card p-4 mb-4 fade-in-up" style="animation-delay: 0.2s" id="solutionSection">
                <div class="section-header mb-4">
                  <div class="section-header__icon section-header__icon--solution"><i class="bi bi-mortarboard"></i></div>
                  <div class="section-header__text">
                    <h5 class="section-header__title mb-0">Solución paso a paso</h5>
                    <span class="section-header__subtitle">Desarrollo pedagógico completo</span>
                  </div>
                  <div class="section-header__actions ms-auto">
                    <button class="btn btn-sm btn-outline-secondary" id="expandAllSteps" title="Expandir todos">
                      <i class="bi bi-arrows-expand"></i>
                    </button>
                  </div>
                </div>
                
                <!-- 5.1 Interpretación del problema -->
                <div class="solution-subsection solution-subsection--interpretation mb-4">
                  <div class="subsection-header">
                    <span class="subsection-number">5.1</span>
                    <h6 class="subsection-title"><i class="bi bi-chat-quote"></i> Interpretación del problema</h6>
                  </div>
                  <div id="resultInterpretation" class="subsection-content interpretation-content">
                    <div class="placeholder-box">
                      <i class="bi bi-file-text"></i>
                      <span>La interpretación aparecerá aquí después de resolver el problema.</span>
                    </div>
                  </div>
                </div>
                
                <!-- 5.2 Procedimiento detallado -->
                <div class="solution-subsection solution-subsection--procedure mb-4">
                  <div class="subsection-header">
                    <span class="subsection-number">5.2</span>
                    <h6 class="subsection-title"><i class="bi bi-list-task"></i> Procedimiento detallado</h6>
                  </div>
                  <div id="resultDetails" class="subsection-content procedure-content">
                    <div class="placeholder-box">
                      <i class="bi bi-journal-code"></i>
                      <span>El procedimiento paso a paso aparecerá aquí.</span>
                    </div>
                  </div>
                </div>
                
                <!-- 5.3 Resultados principales -->
                <div class="solution-subsection solution-subsection--results">
                  <div class="subsection-header">
                    <span class="subsection-number">5.3</span>
                    <h6 class="subsection-title"><i class="bi bi-trophy"></i> Resultados principales</h6>
                  </div>
                  <div id="resultMain" class="subsection-content results-content">
                    <div class="results-grid results-grid--placeholder">
                      <div class="result-card result-card--placeholder">
                        <div class="result-card__icon"><i class="bi bi-geo-alt"></i></div>
                        <div class="result-card__label">Punto óptimo $x^*$</div>
                        <div class="result-card__value">—</div>
                      </div>
                      <div class="result-card result-card--placeholder">
                        <div class="result-card__icon"><i class="bi bi-bullseye"></i></div>
                        <div class="result-card__label">Valor óptimo $f^*$</div>
                        <div class="result-card__value">—</div>
                      </div>
                      <div class="result-card result-card--placeholder">
                        <div class="result-card__icon"><i class="bi bi-tags"></i></div>
                        <div class="result-card__label">Clasificación</div>
                        <div class="result-card__value">—</div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
              
              <!-- ═══════════════════════════════════════════════════════════════════════
                   SECCIÓN 6: ITERACIONES / SISTEMA RESUELTO (opcional por método)
              ═══════════════════════════════════════════════════════════════════════ -->
              {% block iterations_section %}
              <section class="method-section method-section--iterations glass-card p-4 mb-4 fade-in-up" style="animation-delay: 0.3s" id="iterationsSection">
                <div class="section-header mb-4">
                  <div class="section-header__icon section-header__icon--iterations"><i class="bi bi-table"></i></div>
                  <div class="section-header__text">
                    <h5 class="section-header__title mb-0">{% block iterations_title %}Iteraciones / Sistema resuelto{% endblock %}</h5>
                    <span class="section-header__subtitle">{% block iterations_subtitle %}Detalle de cada iteración o sistema de ecuaciones{% endblock %}</span>
                  </div>
                </div>
                
                {% block iterations_content %}
                <div class="iterations-wrapper">
                  <div class="table-responsive table-modern">
                    <table class="table table-iterations">
                      <thead>
                        <tr>
                          <th><span class="th-content">k</span></th>
                          <th><span class="th-content">$x_k$</span></th>
                          <th><span class="th-content">$f(x_k)$</span></th>
                          <th><span class="th-content">$\|\nabla f\|$</span></th>
                          <th><span class="th-content">$\alpha_k$</span></th>
                        </tr>
                      </thead>
                      <tbody id="iters">
                        <tr class="placeholder-row">
                          <td colspan="5">
                            <div class="table-placeholder">
                              <i class="bi bi-clock-history"></i>
                              <span>Sin iteraciones aún. Resuelve un problema para ver los datos.</span>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <!-- Detalle de búsqueda de línea -->
                <div class="line-search-section mt-4" id="lineSearchSection">
                  <div class="subsection-header">
                    <i class="bi bi-search"></i>
                    <h6 class="subsection-title">Búsqueda de línea $(\alpha_k)$</h6>
                  </div>
                  <div id="lineSearchDetails" class="line-search-content">
                    <div class="placeholder-box placeholder-box--small">
                      <i class="bi bi-signpost-split"></i>
                      <span>Sin datos de búsqueda de línea.</span>
                    </div>
                  </div>
                </div>
                {% endblock %}
              </section>
              {% endblock %}
              
              <!-- ═══════════════════════════════════════════════════════════════════════
                   SECCIÓN 7: VISUALIZACIONES (solo para métodos con gráficas)
              ═══════════════════════════════════════════════════════════════════════ -->
              {% block visualizations_section %}
              <!-- Por defecto vacío - solo gradient y lagrange lo sobrescriben -->
              {% endblock %}
              {% endblock %}
            </div>
          </section>
        </main>
      </div>
    </div>

    <div id="sideBackdrop" class="overlay-backdrop overlay-backdrop--enhanced" role="button" aria-label="Cerrar menú" tabindex="-1"></div>
    <aside id="sidePanel" class="overlay-sidebar overlay-sidebar--enhanced" aria-label="Menú lateral">
      <div class="overlay-header p-4 d-flex align-items-center justify-content-between">
        <div class="brand-section">
          <div class="brand brand--enhanced">
            <div class="brand-icon"><i class="bi bi-hexagon"></i></div>
            <div class="brand-text">
              <span class="brand-name">OptiLearn</span>
              <span class="brand-tagline">Optimización Interactiva</span>
            </div>
          </div>
        </div>
        <button class="btn btn-icon btn-icon--close" id="menuClose" title="Cerrar"><i class="bi bi-x-lg"></i></button>
      </div>
      <hr class="overlay-sep my-0">
      <div class="overlay-body p-4">
        <div class="nav-section-title mb-3">
          <i class="bi bi-compass"></i> Navegación
        </div>
        <ul class="list-unstyled nav-vertical method-menu method-menu--enhanced m-0">
          <li>
            <a class="method-menu__link{% if method_key == 'assistant' %} active{% endif %}" href="/">
              <div class="menu-icon"><i class="bi bi-chat-dots"></i></div>
              <div class="menu-content">
                <span class="menu-title">Asistente IA</span>
                <span class="menu-subtitle">Chat educativo</span>
              </div>
            </a>
          </li>
          <li>
            <a class="method-menu__link{% if method_key == 'gradient' %} active{% endif %}" href="/methods/gradient">
              <div class="menu-icon"><i class="bi bi-sliders"></i></div>
              <div class="menu-content">
                <span class="menu-title">Gradiente</span>
                <span class="menu-subtitle">Descenso por gradiente</span>
              </div>
            </a>
          </li>
          <li>
            <a class="method-menu__link{% if method_key == 'lagrange' %} active{% endif %}" href="/methods/lagrange">
              <div class="menu-icon"><i class="bi bi-flag"></i></div>
              <div class="menu-content">
                <span class="menu-title">Lagrange</span>
                <span class="menu-subtitle">Multiplicadores</span>
              </div>
            </a>
          </li>
          <li>
            <a class="method-menu__link{% if method_key == 'kkt' %} active{% endif %}" href="/methods/kkt">
              <div class="menu-icon"><i class="bi bi-shield-check"></i></div>
              <div class="menu-content">
                <span class="menu-title">Condiciones KKT</span>
                <span class="menu-subtitle">Karush-Kuhn-Tucker</span>
              </div>
            </a>
          </li>
          <li>
            <a class="method-menu__link{% if method_key == 'qp' %} active{% endif %}" href="/methods/qp">
              <div class="menu-icon"><i class="bi bi-graph-up-arrow"></i></div>
              <div class="menu-content">
                <span class="menu-title">Prog. Cuadrática</span>
                <span class="menu-subtitle">Optimización QP</span>
              </div>
            </a>
          </li>
          <li>
            <a class="method-menu__link{% if method_key == 'differential' %} active{% endif %}" href="/methods/differential">
              <div class="menu-icon"><i class="bi bi-calculator"></i></div>
              <div class="menu-content">
                <span class="menu-title">Cálculo Diferencial</span>
                <span class="menu-subtitle">Análisis clásico</span>
              </div>
            </a>
          </li>
        </ul>
      </div>
      <div class="overlay-footer mt-auto p-4">
        <div class="theme-toggle-enhanced d-flex align-items-center gap-3">
          <div class="theme-icon theme-icon--moon"><i class="bi bi-moon-stars"></i></div>
          <div class="form-check form-switch m-0">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label" for="themeToggle">Modo oscuro</label>
          </div>
          <div class="theme-icon theme-icon--sun"><i class="bi bi-sun"></i></div>
        </div>
        <div class="footer-info mt-3 text-center small text-muted">
          <span>OptiLearn v2.0</span> · <span>Optimización No Lineal</span>
        </div>
      </div>
    </aside>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
    <script src="/static/opti_app/js/method.js"></script>
  </body>
</html>
