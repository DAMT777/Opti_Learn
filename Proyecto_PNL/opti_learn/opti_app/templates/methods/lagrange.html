{% extends "methods/base.html" %}

{% block hero_color_class %}hero-card--lagrange{% endblock %}

{% block method_icon %}
<i class="bi bi-flag-fill"></i>
{% endblock %}

{% block method_tags %}
<span class="tag tag--method"><i class="bi bi-lock-fill"></i> Restricciones igualdad</span>
<span class="tag tag--level"><i class="bi bi-mortarboard"></i> Intermedio</span>
<span class="tag tag--type"><i class="bi bi-calculator"></i> Analítico</span>
{% endblock %}

{% block method_description %}
Optimiza funciones sujetas a <strong>restricciones de igualdad</strong> usando <strong>multiplicadores de Lagrange</strong>. 
El solver construye paso a paso la <strong>función Lagrangiana</strong> $\mathcal{L}(x, \lambda) = f(x) - \sum \lambda_i g_i(x)$ 
y encuentra puntos donde el gradiente de $f$ es proporcional al gradiente de $g$.
{% endblock %}

{% block method_stats %}
<div class="stat-chip"><i class="bi bi-input-cursor-text"></i> <span>Entrada</span><strong>f(x), g(x)=0</strong></div>
<div class="stat-chip"><i class="bi bi-bullseye"></i> <span>Salida</span><strong>x*, λ*, f*</strong></div>
<div class="stat-chip"><i class="bi bi-diagram-3"></i> <span>Tipo</span><strong>Analítico</strong></div>
{% endblock %}

{% block method_form %}
<!-- Función objetivo -->
<div class="form-group-modern mb-3">
  <label class="form-label-modern">
    <i class="bi bi-function"></i> Función objetivo $f(x)$
    <span class="required-badge">Requerido</span>
  </label>
  <textarea id="objective" class="form-control form-control-modern" rows="2" placeholder="x**2 + y**2">x**2 + y**2</textarea>
  <div class="form-hint"><i class="bi bi-info-circle"></i> Función a minimizar. Ej: <code>x**2 + y**2</code></div>
</div>

<!-- Variables -->
<div class="form-group-modern mb-3">
  <label class="form-label-modern">
    <i class="bi bi-list-ul"></i> Variables de decisión
    <span class="required-badge">Requerido</span>
  </label>
  <input id="variables" class="form-control form-control-modern" placeholder="x,y" value="x,y">
  <div class="form-hint"><i class="bi bi-info-circle"></i> Separadas por coma. Ej: <code>x,y,z</code></div>
</div>
{% endblock %}

{% block method_form_constraints %}
<!-- Restricciones de igualdad -->
<div class="constraints-section">
  <div class="constraints-header">
    <div class="constraints-title">
      <i class="bi bi-lock"></i>
      <span>Restricciones de igualdad $g(x) = 0$</span>
      <span class="required-badge">Requerido</span>
    </div>
    <button type="button" class="btn-add-constraint" id="addConstraintBtn">
      <i class="bi bi-plus-circle"></i> Agregar
    </button>
  </div>
  <div id="constraintsContainer" class="constraints-list mt-2">
    <div class="constraint-row">
      <input type="text" class="form-control form-control-modern constraint-input" placeholder="x + y - 1" value="x + y - 1">
      <span class="constraint-equals">= 0</span>
      <button type="button" class="btn btn-outline-danger btn-remove-constraint" title="Eliminar"><i class="bi bi-x"></i></button>
    </div>
  </div>
  <div class="form-hint mt-2"><i class="bi bi-info-circle"></i> Cada expresión se iguala a cero. Ej: <code>x + y - 1</code> significa $x + y - 1 = 0$</div>
</div>
{% endblock %}

{% block method_form_optional %}
<!-- Sin parámetros opcionales para Lagrange -->
<div class="optional-params mt-3">
  <div class="form-hint text-center">
    <i class="bi bi-gear"></i> Este método analítico no requiere parámetros adicionales.
  </div>
</div>
{% endblock %}

{% block method_examples %}
<div class="examples-section mt-4">
  <div class="examples-header">
    <i class="bi bi-lightning-charge"></i>
    <span>Ejemplos clásicos</span>
  </div>
  <div class="examples-grid">
    <button class="example-btn" 
            data-example="x**2 + y**2" 
            data-vars="x,y" 
            data-constraints='[{"expr": "x + y - 1", "kind": "eq"}]'>
      <i class="bi bi-1-circle"></i> Círculo + recta
    </button>
    <button class="example-btn" 
            data-example="x*y" 
            data-vars="x,y" 
            data-constraints='[{"expr": "x + y - 10", "kind": "eq"}]'>
      <i class="bi bi-2-circle"></i> Maximizar área
    </button>
    <button class="example-btn" 
            data-example="x**2 + y**2 + z**2" 
            data-vars="x,y,z" 
            data-constraints='[{"expr": "x + y + z - 3", "kind": "eq"}]'>
      <i class="bi bi-3-circle"></i> 3 variables
    </button>
    <button class="example-btn" 
            data-example="x**2 + 2*y**2" 
            data-vars="x,y" 
            data-constraints='[{"expr": "x**2 + y**2 - 1", "kind": "eq"}]'>
      <i class="bi bi-4-circle"></i> Elipse sobre círculo
    </button>
  </div>
</div>
{% endblock %}

{% block method_guide %}
<li class="guide-item">
  <span class="guide-number">1</span>
  <span class="guide-text">Ingresa la función objetivo $f(x)$ a minimizar o maximizar.</span>
</li>
<li class="guide-item">
  <span class="guide-number">2</span>
  <span class="guide-text">Define las variables de decisión separadas por comas.</span>
</li>
<li class="guide-item">
  <span class="guide-number">3</span>
  <span class="guide-text">Agrega al menos una restricción de igualdad $g(x) = 0$.</span>
</li>
<li class="guide-item">
  <span class="guide-number">4</span>
  <span class="guide-text">El solver construirá la Lagrangiana y resolverá el sistema.</span>
</li>
<li class="guide-item">
  <span class="guide-number">5</span>
  <span class="guide-text">Analiza los multiplicadores $\lambda$ para entender la sensibilidad.</span>
</li>
{% endblock %}

{% block method_tips %}
<div class="tips-box mt-3">
  <div class="tips-box__header"><i class="bi bi-lightbulb"></i> Concepto clave</div>
  <div class="tips-box__content">
    En el óptimo, el <strong>gradiente de $f$</strong> es una combinación lineal de los <strong>gradientes de las restricciones</strong>:
    $\nabla f = \sum \lambda_i \nabla g_i$. Esto significa que las curvas de nivel de $f$ son tangentes a las restricciones.
  </div>
</div>
{% endblock %}

{% block iterations_title %}Sistema de ecuaciones resuelto{% endblock %}
{% block iterations_subtitle %}Ecuaciones del sistema Lagrangiano $\nabla \mathcal{L} = 0${% endblock %}

{% block iterations_content %}
<div class="lagrange-system-section">
  <div id="lagrangeSystemContent" class="system-content">
    <div class="placeholder-box">
      <i class="bi bi-braces"></i>
      <span>El sistema de ecuaciones Lagrangiano aparecerá aquí después de resolver.</span>
    </div>
  </div>
</div>

<!-- Tabla de puntos críticos -->
<div class="critical-points-section mt-4">
  <div class="subsection-header">
    <i class="bi bi-geo-alt"></i>
    <h6 class="subsection-title">Puntos críticos encontrados</h6>
  </div>
  <div class="table-responsive table-modern mt-3">
    <table class="table table-iterations">
      <thead>
        <tr>
          <th><span class="th-content">#</span></th>
          <th><span class="th-content">$x^*$</span></th>
          <th><span class="th-content">$\lambda^*$</span></th>
          <th><span class="th-content">$f(x^*)$</span></th>
          <th><span class="th-content">Tipo</span></th>
        </tr>
      </thead>
      <tbody id="iters">
        <tr class="placeholder-row">
          <td colspan="5">
            <div class="table-placeholder">
              <i class="bi bi-crosshair"></i>
              <span>Los puntos críticos aparecerán aquí después de resolver.</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block visualizations_content %}
<div class="viz-card" id="plotContour">
  <div class="viz-card__header">
    <i class="bi bi-layers"></i>
    <span>Curvas de nivel + Restricción</span>
  </div>
  <div class="viz-card__body">
    <div class="viz-placeholder">
      <i class="bi bi-bullseye"></i>
      <span>Visualización de tangencia entre curvas de nivel y restricción</span>
    </div>
  </div>
</div>

<div class="viz-card" id="plotSurface">
  <div class="viz-card__header">
    <i class="bi bi-box"></i>
    <span>Superficie 3D + Trayectoria</span>
  </div>
  <div class="viz-card__body">
    <div class="viz-placeholder">
      <i class="bi bi-badge-3d"></i>
      <span>Superficie de f(x,y) con la restricción g(x,y)=0 superpuesta</span>
    </div>
  </div>
</div>

<div class="viz-card viz-card--wide" id="plotGradients">
  <div class="viz-card__header">
    <i class="bi bi-arrow-right-circle"></i>
    <span>Campo de gradientes</span>
  </div>
  <div class="viz-card__body">
    <div class="viz-placeholder">
      <i class="bi bi-arrows-move"></i>
      <span>Visualización de $\nabla f$ y $\nabla g$ en el punto óptimo</span>
    </div>
  </div>
</div>
{% endblock %}
