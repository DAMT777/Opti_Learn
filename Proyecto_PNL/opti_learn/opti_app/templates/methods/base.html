<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OptiLearn – {{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/opti_app/css/app_v2.css" rel="stylesheet">
    <script>
      window.OPTI = { CSRF: "{{ csrf_token }}", METHOD: "{{ method_key }}" };
    </script>
  </head>
  <body class="bg-gradient theme-dark">
    <div class="d-flex min-vh-100 app-shell">
      <div class="flex-grow-1 d-flex flex-column">
        <main class="px-4 pt-2 d-flex flex-column gap-3 method-layout">
          <section class="card-soft p-0 flex-grow-1 w-100">
            <div class="px-3 py-2 d-flex align-items-center gap-2 chat-header">
              <button class="menu-btn" id="menuBtn" title="Menú">
                <span class="inner"></span>
              </button>
              <h6 class="m-0">{{ title }}</h6>
              <div class="ms-auto"></div>
            </div>
            <div class="p-3 d-flex flex-column gap-3">
              <div class="method-hero">
                {% block method_badge %}
                <div class="method-hero__badge"><i class="bi bi-sliders"></i> Método</div>
                {% endblock %}
                <h5 class="mb-1 mt-2">{{ title }}</h5>
                <p class="mb-0 small">{% block method_description %}Describe aquí el objetivo del método.{% endblock %}</p>
                <div class="method-hero__stats">
                  {% block method_stats %}
                  <div><span>Tipo</span>General</div>
                  <div><span>Datos</span>Función y variables</div>
                  <div><span>Salida</span>Punto óptimo</div>
                  {% endblock %}
                </div>
              </div>
              <div class="method-grid">
                <section class="card-soft method-card p-3 method-card--form">
                  <h6 class="mb-2">Campos obligatorios</h6>
                  {% block method_form_required %}
                  <div class="mb-2">
                    <label class="form-label">Función objetivo (SymPy)</label>
                    <textarea id="objective" class="form-control" rows="3" placeholder="(x-1)**2 + (y-2)**2"></textarea>
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Variables (separadas por coma)</label>
                    <input id="variables" class="form-control" placeholder="x,y">
                  </div>
                  {% endblock %}
                  <div class="mb-3 mt-3">
                    <h6 class="mb-2">Campos opcionales</h6>
                    {% block method_form_optional %}
                    <div class="mb-2">
                      <label class="form-label">Vector inicial x<sub>0</sub> (ej. [0.5, -1])</label>
                      <input id="x0" class="form-control" placeholder="[0.5, -1]">
                    </div>
                    <div class="row g-2">
                      <div class="col-md-6">
                        <label class="form-label">Tolerancia</label>
                        <input id="tol" class="form-control" placeholder="1e-6">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Iteraciones máximas</label>
                        <input id="maxIter" class="form-control" placeholder="200">
                      </div>
                    </div>
                    {% endblock %}
                  </div>
                  <div class="d-flex gap-2 flex-wrap">
                    <button id="analyzeBtn" class="btn btn-primary">Analizar</button>
                    <button id="solveBtn" class="btn btn-outline-primary">
                      {% block method_primary_button %}Resolver{% endblock %}
                    </button>
                    <button id="resetBtn" class="btn btn-outline-light">Limpiar formulario</button>
                  </div>
                </section>

                <section class="card-soft method-card p-3">
                  <h6 class="mb-2">Guía rápida</h6>
                  <ul class="method-tips">
                    {% block method_tips %}
                    <li><i class="bi bi-lightbulb"></i><span>Aquí puedes añadir consejos útiles para el usuario.</span></li>
                    {% endblock %}
                  </ul>
                </section>

                <section class="card-soft method-card method-card--errors p-3">
                  <h6 class="mb-2">Validaciones</h6>
                  <div id="methodErrors" class="method-errors text-muted small">Completa la función objetivo y las variables para comenzar.</div>
                </section>

                <section class="card-soft method-card method-card--result p-3">
                  <h6 class="mb-3">Resultado principal</h6>
                  <div id="resultMain" class="method-result-main"></div>
                  <hr>
                  <h6 class="mb-2">Datos intermedios</h6>
                  <div id="resultDetails" class="method-result-details small text-muted"></div>
                  <hr>
                  <h6 class="mb-2">Interpretación</h6>
                  <div id="resultInterpretation" class="method-result-interpretation small text-muted"></div>
                </section>

                <section class="card-soft method-card method-card--iterations p-3">
                  <h6 class="mb-3">Iteraciones / sistema resuelto</h6>
                  <div class="table-responsive">
                    <table class="table table-sm align-middle">
                      <thead>
                        <tr><th>k</th><th>f_k</th><th>||g||</th><th>α_k</th></tr>
                      </thead>
                      <tbody id="iters"></tbody>
                    </table>
                  </div>
                </section>

                <section class="card-soft method-card method-card--graphs p-3">
                  <h6 class="mb-2">Gráficas</h6>
                  <div class="method-graphs">
                    <div class="method-graph" id="plotContour"><span>Curvas de nivel disponibles tras resolver.</span></div>
                    <div class="method-graph" id="plotSurface"><span>Superficie 3D disponible tras resolver.</span></div>
                    <div class="method-graph" id="plotFx"><span>Evolución de f(x<sub>k</sub>) disponible tras resolver.</span></div>
                  </div>
                </section>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <div id="sideBackdrop" class="overlay-backdrop" role="button" aria-label="Cerrar menú" tabindex="-1"></div>
    <aside id="sidePanel" class="overlay-sidebar" aria-label="Menú lateral">
      <div class="overlay-header p-3 d-flex align-items-center justify-content-between">
        <div>
          <div class="brand"><i class="bi bi-hexagon me-2"></i>OptiLearn</div>
          <small class="text-dark-50">Optimización No Lineal</small>
        </div>
        <button class="btn btn-icon" id="menuClose" title="Cerrar"><i class="bi bi-x-lg"></i></button>
      </div>
      <hr class="overlay-sep my-0">
      <div class="overlay-body p-3">
        <div class="mb-2 small text-dark-50">Navegación</div>
        <ul class="list-unstyled small nav-vertical method-menu m-0">
          <li><a class="method-menu__link{% if method_key == 'assistant' %} active{% endif %}" href="/"><i class="bi bi-chat-dots"></i>Asistente educativo</a></li>
          <li><a class="method-menu__link{% if method_key == 'gradient' %} active{% endif %}" href="/methods/gradient"><i class="bi bi-sliders"></i>Gradiente</a></li>
          <li><a class="method-menu__link{% if method_key == 'lagrange' %} active{% endif %}" href="/methods/lagrange"><i class="bi bi-flag"></i>Lagrange</a></li>
          <li><a class="method-menu__link{% if method_key == 'kkt' %} active{% endif %}" href="/methods/kkt"><i class="bi bi-shield-check"></i>Condiciones KKT</a></li>
          <li><a class="method-menu__link{% if method_key == 'qp' %} active{% endif %}" href="/methods/qp"><i class="bi bi-graph-up-arrow"></i>Programación cuadrática</a></li>
          <li><a class="method-menu__link{% if method_key == 'differential' %} active{% endif %}" href="/methods/differential"><i class="bi bi-calculator"></i>Cálculo diferencial</a></li>
        </ul>
      </div>
      <div class="overlay-footer mt-auto p-3 small d-flex align-items-center gap-2">
        <div class="form-check form-switch d-flex align-items-center gap-2 m-0">
          <i class="bi bi-moon"></i>
          <input class="form-check-input" type="checkbox" id="themeToggle">
          <label class="form-check-label mb-0" for="themeToggle">Modo oscuro</label>
        </div>
      </div>
    </aside>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
    <script src="/static/opti_app/js/method.js"></script>
  </body>
</html>
